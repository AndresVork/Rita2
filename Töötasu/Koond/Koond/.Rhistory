# Määra töökaust, mida kasutatakse andmete laadimiseks
# setwd(file.path("/home/raoul/Dokumendid/RM/Töötasu"))
# Kontrolli töökataloogi asukohta
getwd()
# Veebilehe aadress (sõltub kuupäevast)
url <- "https://www.tootukassa.ee/sites/tootukassa.ee/files/asutuste_nimekiri_19.07.2020.xlsx"
local <- file.path("andmed.xlsx")
# Lae fail alla
download.file(url, local)
##############################################
# Töötasutoetuse andmete analüüs
#
# (c) 2020 - Raoul Lättemäe
#
##############################################
library(openxlsx)
library(tidyverse)
# Me kasutame algandmeid kõige esimeselt sheetilt
my.data <- read.xlsx(xlsxFile="andmed.xlsx",
sheet = 1,
#sheetName="Asutuste kokkuvõte_koond",
startRow=2) # Failistruktuur on selline, et andmed hakkavad teisest reast
my.data
# Konverteri tibbleks
my.data <- as_tibble(my.data)
my.data
str(my.data)
########################################
# 2. Kohanda tabel analüüsiks sobivasse struktuuri
########################################
# Muuda veerunimed loetavamaks
colnames(my.data) <- c("registrikood",
"nimi",
"maakond",
"tegevusala",
"EMTAK.2",
"EMTAK.2.kood",
"hyvitise.kuu",
"määramise.nädal",
"saajate.arv",
"brutosumma",
"kogukulu")
str(my.data)
# Kontrolli, et andmeid oleks korrektselt laetud
my.data
# Konverteeri lahtrite struktuur
# registrikood ei ole number
my.data$registrikood <- as.character(my.data$registrikood)
my.data
my.data$maakond <- as.factor(my.data$maakond)
my.data
my.data$tegevusala <- as.factor(my.data$tegevusala)
my.data
my.data$EMTAK.2 <- as.factor(my.data$EMTAK.2)
my.data
my.data$EMTAK.2.kood <- as.factor(my.data$EMTAK.2.kood)
my.data
my.data$määramise.nädal <- as.factor(my.data$määramise.nädal)
my.data
# Kuud on exceli formaadis kuupäevad: konverteeri need kuupäevaks
my.data$hyvitise.kuu <- convertToDate(my.data$hyvitise.kuu)
my.data
tail(my.data)
y
# basic
b <- ggplot(my.data, aes(x = brutosumma/arv, y=fct_infreq(tegevusala)))
# vastavalt b-le
b + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
# basic
b <- ggplot(my.data, aes(x = brutosumma, y=fct_infreq(tegevusala)))
# vastavalt b-le
b + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
# basic
b <- ggplot(my.data, aes(x = brutosumma/saajate.arv, y=fct_infreq(tegevusala)))
# vastavalt b-le
b + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
# Töötukassa ei näita andmeid ettevõtetele, kellel on kuni kolm töötajat
# loo uus veerg, kajastamaks määramata andmed
my.data$avalik <- ifelse(my.data$saajate.arv == "-", FALSE, TRUE)
my.data
my.data[c("nimi", "saajate.arv", "avalik")]
tail(my.data[c("nimi", "saajate.arv", "avalik")])
# tühjenda veerud, mille väärtus on "-"
my.data$saajate.arv[saajate.arv == "-"] <- ""
# tühjenda veerud, mille väärtus on "-"
my.data$saajate.arv <- ifelse(my.data$saajate.arv == "-", "", my.data$saajate.arv)
my.data
tail(my.data)
my.data$saajate.arv <- as.numeric(my.data$saajate.arv)
tail(my.data)
# basic
b <- ggplot(my.data, aes(x = brutosumma/saajate.arv, y=fct_infreq(tegevusala)))
b + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
# basic
b <- ggplot(my.data, aes(x = brutosumma/saajate.arv, y=fct_infreq(tegevusala))) +
theme(
text = element_text(size=12),
axis.text.y = element_text(size=12)
)
b + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
#geom bar
b + geom_bar()
#geom bar
b + geom_bar(mapping = aes(x = tegevusala))
#geom bar
b + geom_bar(mapping = aes(x = tegevusala, y = NA))
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(x = tegevusala))
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(y = tegevusala))
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(y = fct_infreq(tegevusala)))
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(y = fct_infreq(tegevusala)))
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(y = fct_infreq(tegevusala)), stat = "identity")
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(x = fct_infreq(tegevusala)), stat = "identity")
#geom bar
ggplot(my.data) + geom_bar(mapping = aes(y = fct_infreq(tegevusala)))
ggplot(my.data) + geom_bar(mapping = aes(x = saajate.arv, y = fct_infreq(tegevusala)), stat = "identity")
ggplot(my.data) + geom_bar(mapping = aes(x = saajate.arv, y = tegevusala), stat = "identity")
ggplot(my.data) + geom_bar(mapping = aes(x = saajate.arv, y = tegevusala), stat = "identity")
ggplot(my.data) + geom_bar(mapping = aes(x = stat(prop), y = tegevusala), stat = "identity")
ggplot(my.data) + geom_bar(mapping = aes(x = stat(prop), y = tegevusala))
ggplot(my.data) + geom_bar(mapping = aes(x = saajate.arv, y = tegevusala, fill = hyvitise.kuu), stat = "identity")
ggplot(my.data) + geom_bar(mapping = aes(x = saajate.arv, y = tegevusala, fill = hyvitise.kuu), position = "dodge")
ggplot(my.data) + geom_bar(mapping = aes(y = tegevusala, fill = hyvitise.kuu), position = "dodge")
ggplot(my.data) + geom_bar(mapping = aes(y = saajate.arv, fill = hyvitise.kuu), position = "dodge")
# frequency
b + geom_freqpoly(binwidth = 0.1)
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(y = fct_infreq(tegevusala)))
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(y = fct_infreq(tegevusala)), stat = "count")
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(x = fct_infreq(tegevusala)), stat = "count")
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(x = fct_infreq(tegevusala, y = ..density..)), stat = "count")
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(x = fct_infreq(tegevusala), y = ..density..), stat = "count")
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(x = fct_infreq(tegevusala), y = density), stat = "count")
# frequency
ggplot(my.data) + geom_freqpoly(mapping = aes(x = fct_infreq(tegevusala), y = ..density..), binwidth=500, stat = "count")
+ geom_freqpoly(binwidth=500)
# frequency
ggplot(my.data, aes(x = tegevusala, y = ..density..)
# frequency
ggplot(my.data, aes(x = tegevusala, y = ..density..))
# frequency
ggplot(my.data, aes(x = tegevusala, y = ..density..))
# frequency
ggplot(my.data, aes(x = saajate.arv, y = ..density..))
b.ehitus <- subset(my.data, tegevusala %in% c("EHITUS"))
b.plot.ehitus <- ggplot(b.ehitus, aes(x = brutosumma/arv, y=EMTAK.2)) +
theme(
text = element_text(size=12),
axis.text.y = element_text(size=12)
)
b.plot.ehitus + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
b.plot.ehitus <- ggplot(b.ehitus, aes(x = brutosumma/saajate.arv, y=EMTAK.2)) +
theme(
text = element_text(size=12),
axis.text.y = element_text(size=12)
)
b.plot.ehitus + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
b.ehitus <- subset(my.data, tegevusala %in% c("TÖÖTLEV TÖÖSTUS"))
b.plot.ehitus <- ggplot(b.ehitus, aes(x = brutosumma/saajate.arv, y=EMTAK.2)) +
theme(
text = element_text(size=12),
axis.text.y = element_text(size=12)
)
b.plot.ehitus + geom_jitter(shape=16, position=position_jitter(0.2), colour="deepskyblue2",  aplha = I(0.6)) +
geom_boxplot(alpha = I(0.6), outlier.shape=NA)
